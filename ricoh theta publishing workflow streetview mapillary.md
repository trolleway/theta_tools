# Подготовка

1. Достать камеру Ricoh Theta S, шнур, повербанк, Android c хорошим приёмом, палку для селфи, чёрную изоленту.
2. Подготовка: заклеить изолентой лампочки на камере, что бы она меньше бросалась в глаза прохожим. Можно заклеить краем ленты - тогда лампочка включения будет видна сверху.
3. Перед выходом: Освободить память и всё зарядить. Памяти в камере мало.
4. Поставить на Android любой gpx-logger. Поставить его на постоянную запись с минимальным интервалом и максимальной частотой, автоматический старт при загрузке. Проверить, что из него можно вытащить файл gpx. Не выключать его больше никогда в жизни.

# Крепления
1. Нести камеру на палке для селфи.
2. Взять рюкзак с боковыми ремешками и карманами, засунуть в боковой карман любой штатив, прицепить за лямку. Потом у штатива максимально выдвинуть ноги, чтоб они упёрлись в боковой карман рюкзака. Прицепить к штативу палку для селфи, и сесть на велосипед. Пешком так сильно качает.
Рекомендуется надеть головной убор или шлем.
Штатив хорошо бы брать для фотосвета - у него не торчит сбоку ручки.
В принципе бывают штативные винты "мама-папа", только я не знаю, где их брать. С ними камеру на штативе можно подключить к внешнему акумулятору.

# Съёмка
4. Включить автоспуск в авторежиме, и отключить wi-fi на Android для экономии энергии. Так же можно отключить WiFi кнопкой на камере, но я ещё не сравнивал разницу в энергопотреблении. 
5. Помахать камерой, иначе датчики наклона могут выдавать пустые значения.
5. Минимизировать помехи gps для Android, рекомендуют держать его в верхнем кармане рюкзака.
5. Снимать так, пока камера не разрядится. Не нужно беспокоится о том, что фотографии будут слишком скучные или одинаковые. Удалить их потом удобнее, чем прекращать съёмку.
6. При езде на велосипеде опасаться веток.
7. В лесу всегда темно, под деревьями кадры получаются смазанными даже в ясный день.

# Постобработка - геопривязка
1. Слить на PC все фотографии и gpx-треки. 
2. Запустить josm-tested, поставить в него плагины photo_geotagging, photoadjust
3. Перенести в josm драг-энд-дропом треки. Выделить их в списке слоёв, и объединить в один.
4. Перенести в josm драг-энд-дропом фотки. Они привяжутся к треку. 
5. В списке слоёв выберите слой фотографий, в контекстном меню "Сопоставить изображения с GPX-треком", галочку "Изображения с координатами" - ВКЛЮЧИТЬ. josm_georefrence_time.png
6. В контекстном меню слоя с фотографиями - "Записать координаты в заголовок изображения". В окне: "Сохранить резервный файл" - не нужно, "Поменять время внесения изменений - неизменёное mtime"
7. Если бы всё было так просто, то давно бы уже всё автоматизировали. Часть фотографий была снята в то время, когда GPS не работал, их координаты нужно указать вручную (или выбрать и убрать подальше). Нам потребуется файловый менеджер, который умеет показывать кастомные EXIF-теги. На Ubuntu я такой не нашёл. Под Windows есть GeoSetter (гибнет, задание координат фото там уже сломано), а я использую Total Commander с плагином exif.wdx. Я сделал свой набор колонок, и таким образом могу отбирать фотографии без координат и без направления съёмки. totalcmd_coordinates.png
8. Выберите в файловом менеджере фотографии без координат, перетащите их в JOSM. Появится окно "Сопоставить изображения в GPS-треком" - нажмите Cancel. Активируйте слой "Изображения" и окно фотографии. 
9. Нужно привязать все оставшиеся фото к координатам.  Задать координаты - Shift+нажатие мыши. Так же нужно задать направление центра снимка: Ctrl+нажатие мыши. Перемещение между фото - по кнопкам в окне просмотра. После завершения - выберите "Записать координаты в заголовок изображения".
10. У камеры Ricoh Theta S есть глюк: некоторые фотографии не имеют направления. Отберите их так же, как на предыдущем шаге, и задайте направление.

# Обработка сферических панорам для загрузки
1. Склонируйте себе репозитории https://github.com/trolleway/theta_tools и https://github.com/mapillary/mapillary_tools
1. У JOSM есть глюк: панорамы с заданным вручную направлением не читаются в Google Street View. Починить такие фотографии можно так: python theta_tools/regenerate_direction.py c:/path/to/folder. Теперь эти фотографии можно перенести обратно на Android и загружать в Google Street View.
